<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EV Wallet - Bản đồ Trạm Sạc</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- CSS của bạn -->
    <link rel="stylesheet" href="./src/css/reset.css">
    <link rel="stylesheet" href="./src/css/style.css">

    <!-- icon -->
     <link rel="shortcut icon" href="./src/img/tachnen.png" type="image/x-icon">
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="header__top">
                    <a href="index.html" class="logo-container">
                        <img src="./src/img/tachnen.png" alt="Logo EV">
                        <h1>EV</h1>
                    </a>
                 <i class="fa-solid fa-bars menu_icon" id="menu-icon"></i>
                <nav class="header__nav">
                    <ul class="nav__list">
                        <li class="nav__item">
                            <a class="navbar__link" href="./index.html">
                                Trang chủ
                            </a>
                        </li>
                        <li class="nav__item">
                            <a class="navbar__link" href="./profile.html">
                                Hồ sơ
                            </a>
                        </li>
                        <li class="nav__item">
                            <a class="navbar__link" href="./analytics.html">
                                Lịch Sử
                            </a>
                        </li>
                        <li class="nav__item">
                            <a class="navbar__link" href="./login.html">
                                Đăng Nhập
                            </a>
                        </li>
                    </ul>
                </nav>
            </div>
        </div>
    </header>
   
    <!-- Main -->
    <main>
        <section class="main__section">
            <div class="container">
                <h2 class="section__title">Bản đồ các trạm sạc</h2>
                <div class="subpanel active" id="driver-map">
                    <div class="filters">
                        <div class="search-wrapper">
                            <input id="searchInput" placeholder="Tìm trạm theo địa điểm..."  type="text"/>
                            <i class="fa-solid fa-search"></i>
                            <div class="header__search-history">
                   <h3 class="header__search-history-heading">Lịch sử tìm kiếm</h3>
                  <ul class="header__search-history-list">
                <li class="header__search-history-item">
                  <a href="">Trạm sạc Bình Thạnh 1</a>
            </li>
            <li class="header__search-history-item">
              <a href="">Trạm sạc Gò Vấp</a>
            </li>
            <li class="header__search-history-item">
              <a href="">Trạm sạc Thủ Đức</a>
            </li>
          </ul>
                            </div>
                        </div>
                        <div class="filter-group">
                            <div class="select-menu">
                                <div class="select">
                                    <span>Tất cả</span>
                                    <i class="fa-solid fa-angle-down"></i>
                                </div>
                                <div class="option-list">
                                    <div class="option">CCS</div>
                                    <div class="option">CHAdeMO</div>
                                    <div class="option">AC</div>
                                </div>
                            </div>
                            <div class="select-menu">
                                <div class="select">
                                    <span>Trạng thái</span>
                                    <i class="fa-solid fa-angle-down"></i>
                                </div>
                                <div class="option-list">
                                    <div class="option">Trống</div>
                                    <div class="option">Đang dùng</div>
                                </div>
                            </div>
                            <button id="currentLocation" class="btn-location">
                                <i class="fa-solid fa-location-arrow"></i> Vị trí hiện tại
                            </button>
                        </div>
                    </div>
                    <div class="map-grid">
                        <div id="map" class="map"></div>
                        <aside class="list" id="stationList">
                            <div class="list-header">
                                <h3>Danh sách trạm gần nhất</h3>
                                <p id="stationCount">3 trạm</p>
                            </div>
                            <div id="listContent" class="scrollable-list"></div> <!-- Thêm class scrollable-list -->
                        </aside>
                    </div>
                </div>
            </div>
        </section>
    </main>
      <footer>
        <div class="container">
          
              <h2>&copy; Copyright © 2025 EV Wallet. All rights reserved.</h2>
                
        </div>
    </footer>

    <!-- Thêm file JS riêng -->
    <script>
        // Navbar management inline
        function updateNavbar() {
            const jwt_token = localStorage.getItem('jwt_token');
            const userName = localStorage.getItem('userName');
            const userRole = localStorage.getItem('userRole');
            
            const navList = document.querySelector('.nav__list');
            const loginNavItem = navList.querySelector('li:last-child');
            
            if (jwt_token && userName) {
                loginNavItem.innerHTML = `
                    <div style="position: relative; cursor: pointer;">
                        <span style="color: white; display: flex; align-items: center; gap: 8px;">
                            <i class="fa-solid fa-user"></i> ${userName}
                        </span>
                        <div style="position: absolute; top: 100%; right: 0; background: white; border-radius: 8px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); min-width: 200px; display: none;" class="user-dropdown">
                            <a href="./profile.html" style="display: flex; align-items: center; gap: 10px; padding: 12px 16px; color: #333; text-decoration: none; border-bottom: 1px solid #eee;">
                                <i class="fa-solid fa-user-circle"></i> Hồ sơ
                            </a>
                            <a href="#" onclick="logout()" style="display: flex; align-items: center; gap: 10px; padding: 12px 16px; color: #dc3545; text-decoration: none;">
                                <i class="fa-solid fa-sign-out-alt"></i> Đăng Xuất
                            </a>
                        </div>
                    </div>
                `;
                
                // Add hover effect
                const userMenu = loginNavItem.querySelector('div');
                const dropdown = userMenu.querySelector('.user-dropdown');
                userMenu.addEventListener('mouseenter', () => dropdown.style.display = 'block');
                userMenu.addEventListener('mouseleave', () => dropdown.style.display = 'none');
            } else {
                loginNavItem.innerHTML = `
                    <a class="navbar__link" href="./login.html">
                        <i class="fa-solid fa-sign-in-alt"></i> Đăng Nhập
                    </a>
                `;
            }
        }

        function logout() {
            localStorage.clear();
            alert('Đăng xuất thành công!');
            window.location.href = 'index.html';
        }

        // Initialize when DOM loads
        document.addEventListener('DOMContentLoaded', updateNavbar);
        if (document.readyState !== 'loading') updateNavbar();
        
        // Update navbar when page becomes visible (after redirect from login)
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                setTimeout(updateNavbar, 100);
            }
        });
        
        // Update navbar when localStorage changes (from other tabs or after login)
        window.addEventListener('storage', updateNavbar);
        
        // Also try updating after a short delay (for login redirects)
        setTimeout(updateNavbar, 500);
    </script>
    
    <!-- Load map.js first to ensure initMap is available -->
    <script src="./src/js/map.js"></script>
    
    <!-- Ensure initMap is globally available before Google Maps loads -->
    <script>
        // Global fallback initMap function in case map.js fails to load
        if (typeof window.initMap !== 'function') {
            window.initMap = function() {
                console.error('Map initialization failed - map.js may not have loaded properly');
                const mapContainer = document.getElementById('map');
                if (mapContainer) {
                    mapContainer.innerHTML = '<div style="display: flex; align-items: center; justify-content: center; height: 100%; background: #f5f5f5; color: #666;">Không thể tải bản đồ</div>';
                }
            };
        }
    </script>
    
    <!-- Navbar Enhancement -->
    <script src="./src/js/navbar.js"></script>
    
    <!-- Load Google Maps API after map.js is ready -->
    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCdiPStX3WkfOkp11UQ0N6g9DjBGCODdNY&callback=initMap&libraries=marker,places&loading=async&v=quarterly"></script>
    <script src="./src/js/selects.js"></script>
</body>
</html>